HTTP/2.0 200 OK
Accept-Ranges: bytes
Age: 280349
Cache-Control: public, max-age=0, must-revalidate
Content-Type: text/html; charset=UTF-8
Date: Sun, 07 May 2023 08:39:51 GMT
Etag: "6e4788187507fcbb956be311665d0267-ssl-df"
Server: Netlify
Strict-Transport-Security: max-age=31536000
Vary: Accept-Encoding
X-Nf-Request-Id: 01H0317K6ZGC3SRX4QEWY6SH3J

<!DOCTYPE html><html lang="en"><head><link rel="stylesheet" href="/css/live-blocks.css"><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="IE=edge"><meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="description" content="Policy-based control for cloud native environments"><meta property="og:title" content="Open Policy Agent"><meta property="og:url" content="https://www.openpolicyagent.org/"><meta property="og:locale" content="en_US"><meta property="og:description" content="Policy-based control for cloud native environments"><meta name="og:type" content="website"><meta name="og:image" content="https://www.openpolicyagent.org/img/logos/opa-horizontal-color.png"><meta name="og:image:alt" content="Open Policy Agent project logo"><meta name="og:image:type" content="image/png"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@OpenPolicyAgent"><meta name="twitter:creator" content="@OpenPolicyAgent"><link rel="canonical" href="#ZgotmplZ"><link rel="shortcut icon" href="/favicon.png" type="image/x-icon"><meta name="docsearch:language" content="en"><meta name="docsearch:version" content=""><meta name="generator" content="Hugo 0.109.0"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel="stylesheet" href="css/bootstrap.min.css"><title>Open Policy Agent</title><link rel="stylesheet" href="./css/home.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JNBNV64PDX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JNBNV64PDX');
</script>
</head><body data-spy="scroll" data-target=".navbar" data-offset="90"><div id="navigation"><nav class="navbar navbar-expand-lg navbar-dark bg-transparent"><div class="container"><a class="navbar-brand" href="/"><img src="https://d33wubrfki0l68.cloudfront.net/a5bf5cefceefdba8ab3a9297fddab246355169a2/4a6f4/img/logo-white.png" class="img-fluid"></a>
<button class="navbar-toggler navbar-toggler-right collapsed" type="button" data-toggle="collapse" data-target="#navb" aria-expanded="false">
<span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="navb"><ul class="navbar-nav mr-auto"></ul><ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="./docs/latest/">Docs</a></li><li class="nav-item"><a class="nav-link" href="./docs/latest/#running-opa">Download</a></li><li class="nav-item"><a class="nav-link" href="./docs/latest/ecosystem/">Ecosystem</a></li><li class="nav-item"><a class="nav-link" href="./security">Security</a></li><li class="nav-item"><a class="nav-link" href="./support">Support</a></li><li class="nav-item"><a class="nav-link" href="./community">Community</a></li><li class="nav-item"><a class="nav-link" href="https://play.openpolicyagent.org/">Play</a></li><li class="nav-item"><a class="nav-link" href="https://blog.openpolicyagent.org/">Blog</a></li><li class="nav-item social-nav-item"><a class="nav-link social-icon-link" href="https://twitter.com/openpolicyagent"><img src="https://d33wubrfki0l68.cloudfront.net/fdec5b01cd30809561bcaee91c3cbb1acf24cc06/0f978/img/twitter-icon.png" alt="Twitter"><div class="nav-link social-icon-title">Twitter</div></a></li><li class="nav-item social-nav-item"><a class="nav-link social-icon-link" href="https://slack.openpolicyagent.org/"><img src="https://d33wubrfki0l68.cloudfront.net/c2c373df171c5a8a73eb131f27236a37b2244026/25c46/img/slack-icon.png" alt="Slack"><div class="nav-link social-icon-title">Slack</div></a></li><li class="nav-item social-nav-item"><a class="nav-link social-icon-link" href="https://github.com/open-policy-agent/opa"><img src="https://d33wubrfki0l68.cloudfront.net/c984b2d04c34078901d27bc6d5686483225fc948/60a4e/img/github-icon.png" alt="GitHub"><div class="social-icon-title">GitHub</div></a></li></ul></div></div></nav></div><section id="homebackground"><div class="bg"><div class="banner-content">Policy-based control for cloud native
environments</div><div class="banner-subcontent">Flexible, fine-grained control for
administrators across the stack</div><img src="https://d33wubrfki0l68.cloudfront.net/965b3d00a65c84c83bed88b2e70f1a3baff767cc/801b5/img/banner-image.png"><div class="mobile-view-Banner"><img src="https://d33wubrfki0l68.cloudfront.net/62ad9eb987dbcb4f6392389bc469697e62cb70ac/ed3b6/img/opa-mobile-banner_mobile.png"></div></div></section><div class="clearfix"></div><section id="about"><div class="container"><div class="row"><div class="col-12"><div class="about-text"><p>Stop using a different policy language, policy model, and policy
API for every product and service you use. Use OPA for a unified
toolset and framework for policy across the cloud native stack.</p></div><div class="subparagraph about-text"><p>Whether for one service or for all your services, use OPA to
decouple policy from the service's code so you can release,
analyze, and review policies (which security and compliance teams
love) without sacrificing availability or performance.</p></div><div class="mt-5 text-center"><div class="styraText"><p>Created By</p><span><a href="https://styra.com"><img src="https://d33wubrfki0l68.cloudfront.net/ce60c030ed59a4a5e5809aadbaf79f8ed13bcb67/b825f/img/styra-logo.jpg" class="img-fluid"></a></span></div></div></div></div></div></section><section id="gray"><div class="gray-top-image"><img src="https://d33wubrfki0l68.cloudfront.net/3c1025148f4d054b3e8791308a719f5d468158a3/71f08/img/gray-top.png"></div><section id="declarative-policy"><div class="container"><div class="row desktopView"><div class="col-12 text-center pt-5"><h2>Declarative Policy</h2><div class="subText">Context-aware, Expressive, Fast, Portable</div></div><div class="col-12 mt-sm-5"><div class="declarative-table mt-5"><div class="tab-pane" id="tab-5" role="tabpanel"><ul class="nav nav-tabs" role="tablist" id="tableOne"><li class="nav-item"><a class="nav-link nav-width active" data-toggle="tab" href="#tabs-1" role="tab"><img src="https://d33wubrfki0l68.cloudfront.net/99a88d00852b40cee4d37fc26811b759f16fad73/46faf/img/policyicon-1.png">
Kubernetes</a></li><li class="nav-item"><a class="nav-link nav-width" data-toggle="tab" href="#tabs-2" role="tab"><img src="https://d33wubrfki0l68.cloudfront.net/9e3bb4c6bb4d9cd3d7517e39af0a92c4dcb1ba04/03a43/img/envoy-square.png">
Envoy</a></li><li class="nav-item"><a class="nav-link nav-width" data-toggle="tab" href="#tabs-4" role="tab"><img src="https://d33wubrfki0l68.cloudfront.net/c83ed7e2ae33852707ebfa94184e6a408b4b5734/fa9cc/img/policyicon-4.png">
Application</a></li></ul><div class="tab-content"><div class="tab-pane active" id="tabs-1" role="tabpanel"><div class="tab-innerContainer"><div class="row"><div class="col-12 col-sm-12 col-md-12 col-lg-4"><div class="declarative-left"><div class="current"></div><div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical"><a class="nav-link active" id="v-pills-k8s-1-desktop-tab" data-toggle="pill" href="#v-pills-k8s-1-desktop-content" role="tab" aria-controls="v-pills-k8s-1-desktop-content" aria-selected="true">Ensure all images come
from a trusted registry</a>
<a class="nav-link" id="v-pills-k8s-2-desktop-tab" data-toggle="pill" href="#v-pills-k8s-2-desktop-content" role="tab" aria-controls="v-pills-k8s-2-desktop-content" aria-selected="false">Stop ingresses from using
the same host name</a></div></div></div><div class="col-12 col-sm-12 col-md-12 col-lg-8"><div class="declarative-right"><div class="tab-content code-tab-content" id="v-pills-tabContent"><div class="tab-pane fade show active" id="v-pills-k8s-1-desktop-content" role="tabpanel" aria-labelledby="v-pills-k8s-1-desktop-tab"><div class="col-12 highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Input">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/a72e369b12655c412801fbd814fe535d9f666efc/bdf60/live-blocks/icons/input.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                                    <code class="language-live" data-lang="live:kubernetes_registry_check_desktop:input:hidden">{
    "apiVersion": "admission.k8s.io/v1beta1",
    "kind": "AdmissionReview",
    "request": {
        "kind": {
            "group": "",
            "kind": "Pod",
            "version": "v1"
        },
        "object": {
            "metadata": {
                "name": "myapp"
            },
            "spec": {
                "containers": [
                    {
                        "image": "nginx",
                        "name": "nginx-frontend"
                    },
                    {
                        "image": "mysql",
                        "name": "mysql-backend"
                    }
                ]
            }
        }
    }
}</code>
                                        </pre></div></div><div class="highlight"><a onclick="window.open(&quot;https://play.openpolicyagent.org/p/9OTwNMYSog&quot;)"><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/155a3123feaa31368bec7dd7ea5ccc5140457d50/b4277/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                                          <code class="language-live" data-lang="live:kubernetes_registry_check_desktop:module:read_only">package kubernetes.admission

import future.keywords

deny contains msg if {
	input.request.kind.kind == "Pod"
	some container in input.request.object.spec.containers
	image := container.image
	not startswith(image, "hooli.com/")
	msg := sprintf("image '%s' comes from untrusted registry", [image])
}</code>
                                        </pre></div></a></div><div class="highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/c727984413d6c6b592f82ed5646785be10c35074/29a96/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                                    <code class="language-live" data-lang="live:kubernetes_registry_check_desktop:output:hidden">{
  "deny": [
    "image 'mysql' comes from untrusted registry",
    "image 'nginx' comes from untrusted registry"
  ]
}</code>
                                  </pre></div></div><div class="text-center blue"><button class="mt-4 btn btn-primary btn-playground"><a target="_blank" href="https://play.openpolicyagent.org/p/9OTwNMYSog">Open In Playground
<img src="https://d33wubrfki0l68.cloudfront.net/636e8b60e8dfcf5619ecb9ceea4bba9a526ca7d9/2d2ec/live-blocks/icons/playground-open.svg" class="launch-playground-icon"></a></button></div></div><div class="tab-pane fade" id="v-pills-k8s-2-desktop-content" role="tabpanel" aria-labelledby="v-pills-k8s-2-desktop-tab"><div class="col-12 highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Input">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/a72e369b12655c412801fbd814fe535d9f666efc/bdf60/live-blocks/icons/input.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                                    <code class="language-live" data-lang="live:kubernetes_ingress_check_desktop:input:hidden">{
    "apiVersion": "admission.k8s.io/v1beta1",
    "kind": "AdmissionReview",
    "request": {
        "kind": {
            "group": "extensions",
            "kind": "Ingress",
            "version": "v1beta1"
        },
        "object": {
            "metadata": {
                "name": "prod",
                "namespace": "bar"
            },
            "spec": {
                "rules": [
                    {
                        "host": "initech.com",
                        "http": {
                            "paths": [
                                {
                                    "backend": {
                                        "serviceName": "banking",
                                        "servicePort": 443
                                    },
                                    "path": "/finance"
                                }
                            ]
                        }
                    }
                ]
            }
        }
    }
}</code>
                                  </pre></div></div><div class="highlight"><a onclick="window.open(&quot;https://play.openpolicyagent.org/p/lttuKeuUpW&quot;)"><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/155a3123feaa31368bec7dd7ea5ccc5140457d50/b4277/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                                      <code class="language-live" data-lang="live:kubernetes_ingress_check_desktop:module:read_only">package kubernetes.admission

import future.keywords

# Reject any ingress with the same host as an existing ingress
deny contains msg if {
	input.request.kind.kind == "Ingress"

	# iterate over all hosts in input Ingress
	some rule in input.request.object.spec.rules
	newhost := rule.host

	# iterate over all existing ingresses and all hosts for each ingress
	some namespace, name
	some oldrule in data.kubernetes.ingresses[namespace][name].spec.rules
	oldhost := oldrule.host

	# reject if the oldhost and the newhost are the same
	newhost == oldhost
	msg := sprintf("ingress host conflicts with ingress %s/%s", [namespace, name])
}</code>
                                    </pre></div></a></div><div class="highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/c727984413d6c6b592f82ed5646785be10c35074/29a96/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                                      <code class="language-live" data-lang="live:kubernetes_ingress_check_desktop:output:hidden">{
  "deny": []
}</code>
                                    </pre></div></div><div class="text-center blue"><button class="mt-4 btn btn-primary btn-playground"><a target="_blank" href="https://play.openpolicyagent.org/p/lttuKeuUpW">Open In Playground
<img src="https://d33wubrfki0l68.cloudfront.net/636e8b60e8dfcf5619ecb9ceea4bba9a526ca7d9/2d2ec/live-blocks/icons/playground-open.svg" class="launch-playground-icon"></a></button></div></div></div></div></div></div></div></div><div class="tab-pane" id="tabs-2" role="tabpanel"><div class="row"><div class="col-12 col-sm-12 col-md-12 col-lg-4"><div class="declarative-left"><div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical"><a class="nav-link active" id="v-pills-envoy-1-desktop-tab" data-toggle="pill" href="#v-pills-envoy-1-desktop-content" role="tab" aria-controls="v-pills-envoy-1-desktop-content" aria-selected="true">Allow everyone to run GET on
<code>/pets</code></a>
<a class="nav-link" id="v-pills-envoy-2-desktop-tab" data-toggle="pill" href="#v-pills-envoy-2-desktop-content" role="tab" aria-controls="v-pills-envoy-2-desktop-content" aria-selected="false">Allow frontend service to
run GET on <code>/pets/owners</code></a></div></div></div><div class="col-12 col-sm-12 col-md-12 col-lg-8"><div class="declarative-right"><div class="tab-content code-tab-content" id="v-pills-tabContent"><div class="tab-pane fade show active" id="v-pills-envoy-1-desktop-content" role="tabpanel" aria-labelledby="v-pills-envoy-1-desktop-tab"><div class="col-12 highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Input">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/a72e369b12655c412801fbd814fe535d9f666efc/bdf60/live-blocks/icons/input.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                                  <code class="language-live" data-lang="live:envoy_get_pets_desktop:input:hidden">{
    "attributes": {
        "destination": {
            "address": {
                "Address": {
                    "SocketAddress": {
                        "PortSpecifier": {
                            "PortValue": 8000
                        },
                        "address": "172.17.0.8"
                    }
                }
            }
        },
        "request": {
            "http": {
                "headers": {
                    ":authority": "example-app",
                    ":method": "GET",
                    ":path": "/pets",
                    "user-agent": "Wget",
                    "x-forwarded-proto": "http",
                    "x-request-id": "4d75f8d5-983f-4ec5-92bb-d27e620b4921"
                },
                "host": "example-app",
                "id": "8910035251488566126",
                "method": "GET",
                "path": "/pets",
                "protocol": "HTTP/1.1"
            }
        },
        "source": {
            "address": {
                "Address": {
                    "SocketAddress": {
                        "PortSpecifier": {
                            "PortValue": 54292
                        },
                        "address": "172.17.0.6"
                    }
                }
            }
        }
    },
    "parsed_path": [
        "pets"
    ]
}</code>
                                </pre></div></div><div class="highlight"><a onclick="window.open(&quot;https://play.openpolicyagent.org/p/WXAYEQWHKI&quot;)"><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/155a3123feaa31368bec7dd7ea5ccc5140457d50/b4277/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                                    <code class="language-live" data-lang="live:envoy_get_pets_desktop:module:read_only">package envoy.authz

import future.keywords

# allow all GET requests to /pets
default allow := false

allow if {
	input.attributes.request.http.method == "GET"
	input.attributes.request.http.path == "/pets"
}</code>
                                  </pre></div></a></div><div class="highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/c727984413d6c6b592f82ed5646785be10c35074/29a96/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                                  <code class="language-live" data-lang="live:envoy_get_pets_desktop:output:hidden">{
  "allow": true
}</code>
                                </pre></div></div><div class="text-center blue"><button class="mt-4 btn btn-primary btn-playground"><a target="_blank" href="https://play.openpolicyagent.org/p/WXAYEQWHKI">Open In Playground
<img src="https://d33wubrfki0l68.cloudfront.net/636e8b60e8dfcf5619ecb9ceea4bba9a526ca7d9/2d2ec/live-blocks/icons/playground-open.svg" class="launch-playground-icon"></a></button></div></div><div class="tab-pane fade" id="v-pills-envoy-2-desktop-content" role="tabpanel" aria-labelledby="v-pills-envoy-2-desktop-tab"><div class="col-12 highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Input">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/a72e369b12655c412801fbd814fe535d9f666efc/bdf60/live-blocks/icons/input.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                                  <code class="language-live" data-lang="live:envoy_get_pets_owners_desktop:input:hidden">{
    "attributes": {
        "destination": {
            "address": {
                "Address": {
                    "SocketAddress": {
                        "PortSpecifier": {
                            "PortValue": 8000
                        },
                        "address": "172.17.0.8"
                    }
                }
            }
        },
        "request": {
            "http": {
                "headers": {
                    ":authority": "example-app",
                    ":method": "GET",
                    ":path": "/pets/owners",
                    "user-agent": "Wget",
                    "x-forwarded-client-cert": "By=spiffe://domain.test/db-server;Hash=331f2f4eb2a1729fa4e0f46c8c663786098151ae571fed7b66680e970f6a0f94;URI=spiffe://domain.test/frontend",
                    "x-forwarded-proto": "http",
                    "x-request-id": "4d75f8d5-983f-4ec5-92bb-d27e620b4921"
                },
                "host": "example-app",
                "id": "8910035251488566126",
                "method": "GET",
                "path": "/pets/owners",
                "protocol": "HTTP/1.1"
            }
        },
        "source": {
            "address": {
                "Address": {
                    "SocketAddress": {
                        "PortSpecifier": {
                            "PortValue": 54292
                        },
                        "address": "172.17.0.6"
                    }
                }
            }
        }
    },
    "parsed_path": [
        "pets",
        "owners"
    ]
}</code>
                                </pre></div></div><div class="highlight"><a onclick="window.open(&quot;https://play.openpolicyagent.org/p/6t8n43lY8W&quot;)"><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/155a3123feaa31368bec7dd7ea5ccc5140457d50/b4277/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                                        <code class="language-live" data-lang="live:envoy_get_pets_owners_desktop:module:read_only">package envoy.authz

import future.keywords
import input.attributes.request.http as http_request

# allow only the frontend service to GET /pets/owners
default allow := false

allow if {
	http_request.path == "/pets/owners"
	http_request.method == "GET"
	source_spiffe_id == "spiffe://domain.test/frontend"
}

source_spiffe_id := client_id if {
	[_, _, uri_type_san] := split(http_request.headers["x-forwarded-client-cert"], ";")
	[_, client_id] := split(uri_type_san, "=")
}</code>
                                  </pre></div></a></div><div class="highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/c727984413d6c6b592f82ed5646785be10c35074/29a96/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                                  <code class="language-live" data-lang="live:envoy_get_pets_owners_desktop:output:hidden">{
  "allow": true,
  "source_spiffe_id": "spiffe://domain.test/frontend"
}</code>
                                </pre></div></div><div class="text-center blue"><button class="mt-4 btn btn-primary btn-playground"><a target="_blank" href="https://play.openpolicyagent.org/p/6t8n43lY8W">Open In Playground
<img src="https://d33wubrfki0l68.cloudfront.net/636e8b60e8dfcf5619ecb9ceea4bba9a526ca7d9/2d2ec/live-blocks/icons/playground-open.svg" class="launch-playground-icon"></a></button></div></div></div></div></div></div></div><div class="tab-pane" id="tabs-4" role="tabpanel"><div class="row"><div class="col-12 col-sm-12 col-md-12 col-lg-4"><div class="declarative-left"><div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical"><a class="nav-link active" id="v-pills-app-1-desktop-tab" data-toggle="pill" href="#v-pills-app-1-desktop-content" role="tab" aria-controls="v-pills-app-1-desktop-content" aria-selected="true">Only the pet's owner can
update that pet's information</a>
<a class="nav-link" id="v-pills-app-2-desktop-tab" data-toggle="pill" href="#v-pills-app-2-desktop-content" role="tab" aria-controls="v-pills-app-2-desktop-content" aria-selected="false">Only employees,
authenticated with a JWT, can see already adopted
pets</a></div></div></div><div class="col-12 col-sm-12 col-md-12 col-lg-8"><div class="declarative-right"><div class="tab-content code-tab-content" id="v-pills-tabContent"><div class="tab-pane fade show active" id="v-pills-app-1-desktop-content" role="tabpanel" aria-labelledby="v-pills-app-1-desktop-tab"><div class="col-12 highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Input">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/a72e369b12655c412801fbd814fe535d9f666efc/bdf60/live-blocks/icons/input.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                                    <code class="language-live" data-lang="live:app_check_owner_desktop:input:hidden">{
    "method": "PUT",
    "owner": "bob@hooli.com",
    "path": [
        "pets",
        "pet113-987"
    ],
    "user": "alice@hooli.com"
}</code>
                                  </pre></div></div><div class="highlight"><a onclick="window.open(&quot;https://play.openpolicyagent.org/p/0FjgydMuVo&quot;)"><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/155a3123feaa31368bec7dd7ea5ccc5140457d50/b4277/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                                    <code class="language-live" data-lang="live:app_check_owner_desktop:module:read_only">package application.authz

import future.keywords

# Only owner can update the pet's information
# Ownership information is provided as part of OPA's input
default allow := false

allow if {
	input.method == "PUT"
	some petid
	input.path = ["pets", petid]
	input.user == input.owner
}</code>
                                  </pre></div></a></div><div class="highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/c727984413d6c6b592f82ed5646785be10c35074/29a96/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                                  <code class="language-live" data-lang="live:app_check_owner_desktop:output:hidden">{
  "allow": false
}</code>
                                </pre></div></div><div class="text-center blue"><button class="mt-4 btn btn-primary btn-playground"><a target="_blank" href="https://play.openpolicyagent.org/p/0FjgydMuVo">Open In Playground
<img src="https://d33wubrfki0l68.cloudfront.net/636e8b60e8dfcf5619ecb9ceea4bba9a526ca7d9/2d2ec/live-blocks/icons/playground-open.svg" class="launch-playground-icon"></a></button></div></div><div class="tab-pane fade" id="v-pills-app-2-desktop-content" role="tabpanel" aria-labelledby="v-pills-app-2-desktop-tab"><div class="col-12 highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Input">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/a72e369b12655c412801fbd814fe535d9f666efc/bdf60/live-blocks/icons/input.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                                  <code class="language-live" data-lang="live:app_jwt_auth_desktop:input:hidden">{
    "pet_list": [
        {
            "breed": "St. Bernard",
            "name": "Cujo",
            "up_for_adoption": false
        },
        {
            "breed": "Collie",
            "name": "Lassie",
            "up_for_adoption": true
        }
    ],
    "token": "eyJ1IjoiSFMyNTYiLCJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoiYWxpY2UiLCJlbXBsb3llZSI6dHJ1ZSwibmFtZSI6IkFsaWNlIFNtaXRoIn0.vMBYEW8VK9XM7yPkKTu1C3Gy1tOq1A0d4-xYMkkRpEc"
}</code>
                                </pre></div></div><div class="highlight"><a onclick="window.open(&quot;https://play.openpolicyagent.org/p/P8RBsigBsU&quot;)"><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/155a3123feaa31368bec7dd7ea5ccc5140457d50/b4277/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                                    <code class="language-live" data-lang="live:app_jwt_auth_desktop:module:read_only">package application.authz

import future.keywords

# Everyone can see pets up for adoption
allowed_pets contains pet if {
	some pet in input.pet_list
	pet.up_for_adoption
}

# Employees can see all pets.
allowed_pets contains pet if {
	[_, payload, _] := io.jwt.decode(input.token)
	payload.employee
	some pet in input.pet_list
}</code>
                                  </pre></div></a></div><div class="highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/c727984413d6c6b592f82ed5646785be10c35074/29a96/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                                        <code class="language-live" data-lang="live:app_jwt_auth_desktop:output:hidden">{
  "allowed_pets": [
    {
      "breed": "Collie",
      "name": "Lassie",
      "up_for_adoption": true
    },
    {
      "breed": "St. Bernard",
      "name": "Cujo",
      "up_for_adoption": false
    }
  ]
}</code>
                                      </pre></div></div><div class="text-center blue"><button class="mt-4 btn btn-primary btn-playground"><a target="_blank" href="https://play.openpolicyagent.org/p/P8RBsigBsU">Open In Playground
<img src="https://d33wubrfki0l68.cloudfront.net/636e8b60e8dfcf5619ecb9ceea4bba9a526ca7d9/2d2ec/live-blocks/icons/playground-open.svg" class="launch-playground-icon"></a></button></div></div></div></div></div></div></div></div></div></div></div></div><div class="row mobileView"><div class="col-12 text-center pt-5"><h2>Declarative Policy</h2><div class="subText">Context-aware, Expressive, Fast, Portable</div></div><div class="col-12 mt-3 mt-sm-5"><div class="row"><div class="col-6 col-sm-6 col-md-6 col-lg-3"><div class="declarativeBOx"><a href="#kubernetes"><div class="declarativeInnerBOx"><img src="https://d33wubrfki0l68.cloudfront.net/99a88d00852b40cee4d37fc26811b759f16fad73/46faf/img/policyicon-1.png" class="declarativeImage"><p class="declarativeText">Kubernetes</p></div><div class="downArrow"><img src="https://d33wubrfki0l68.cloudfront.net/6586564258a5df9f6a94d37335fe71e70c00f34c/96e4e/img/downarrow.svg"></div></a></div></div><div class="col-6 col-sm-6 col-md-6 col-lg-3"><div class="declarativeBOx envoy"><a href="#envoy"><div class="declarativeInnerBOx"><img src="https://d33wubrfki0l68.cloudfront.net/455409a53c04437f56a44c00d688dc354f65c656/b0182/img/policyicon-2.png" class="declarativeImage"><p class="declarativeText">Envoy</p></div><div class="downArrow"><img src="https://d33wubrfki0l68.cloudfront.net/6586564258a5df9f6a94d37335fe71e70c00f34c/96e4e/img/downarrow.svg"></div></a></div></div><div class="col-6 col-sm-6 col-md-6 col-lg-3"><div class="declarativeBOx"><a href="#application"><div class="declarativeInnerBOx"><img src="https://d33wubrfki0l68.cloudfront.net/c83ed7e2ae33852707ebfa94184e6a408b4b5734/fa9cc/img/policyicon-4.png" class="declarativeImage"><p class="declarativeText">Application</p></div><div class="downArrow"><img src="https://d33wubrfki0l68.cloudfront.net/6586564258a5df9f6a94d37335fe71e70c00f34c/96e4e/img/downarrow.svg"></div></a></div></div></div></div><div class="col-12 mt-3 mt-sm-5" id="kubernetes"><div class="declarative-policy-contentBox"><div class="declarative-policy-contentBox-header"><img src="https://d33wubrfki0l68.cloudfront.net/99a88d00852b40cee4d37fc26811b759f16fad73/46faf/img/policyicon-1.png" class="declarativeImage"><p class="declarativeText">Kubernetes</p></div><div class="row"><div class="col-12 col-sm-12 col-md-12 col-lg-4"><div class="declarative-left"><div class="current"></div><div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical"><a class="nav-link active" id="v-pills-k8s-1-mobile-tab" data-toggle="pill" href="#v-pills-k8s-1-mobile-content" role="tab" aria-controls="v-pills-k8s-1-mobile-content" aria-selected="true">Ensure all images come from a
trusted registry</a>
<a class="nav-link" id="v-pills-k8s-2-mobile-content-tab" data-toggle="pill" href="#v-pills-k8s-2-mobile-content" role="tab" aria-controls="v-pills-k8s-2-mobile-content" aria-selected="false">Stop
ingresses from using the same host name</a></div></div></div><div class="col-12 col-sm-12 col-md-12 col-lg-8"><div class="declarative-right"><div class="tab-content code-tab-content" id="v-pills-tabContent"><div class="tab-pane fade show active" id="v-pills-k8s-1-mobile-content" role="tabpanel" aria-labelledby="v-pills-k8s-1-mobile-content-tab"><div class="col-12 highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Input">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/a72e369b12655c412801fbd814fe535d9f666efc/bdf60/live-blocks/icons/input.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                              <code class="language-live" data-lang="live:kubernetes_registry_check_mobile:input:hidden">{
    "apiVersion": "admission.k8s.io/v1beta1",
    "kind": "AdmissionReview",
    "request": {
        "kind": {
            "group": "",
            "kind": "Pod",
            "version": "v1"
        },
        "object": {
            "metadata": {
                "name": "myapp"
            },
            "spec": {
                "containers": [
                    {
                        "image": "nginx",
                        "name": "nginx-frontend"
                    },
                    {
                        "image": "mysql",
                        "name": "mysql-backend"
                    }
                ]
            }
        }
    }
}</code>
                            </pre></div></div><div class="highlight"><a onclick="window.open(&quot;https://play.openpolicyagent.org/p/9OTwNMYSog&quot;)"><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/155a3123feaa31368bec7dd7ea5ccc5140457d50/b4277/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                              <code class="language-live" data-lang="live:kubernetes_registry_check_mobile:module:read_only">package kubernetes.admission

import future.keywords

deny contains msg if {
	input.request.kind.kind == "Pod"
  some container in input.request.object.spec.containers
  image := container.image
	not startswith(image, "hooli.com/")
	msg := sprintf("image '%v' comes from untrusted registry", [image])
}</code>
                            </pre></div></a></div><div class="highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/c727984413d6c6b592f82ed5646785be10c35074/29a96/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                              <code class="language-live" data-lang="live:kubernetes_registry_check_mobile:output:hidden">{
  "deny": [
    "image 'mysql' comes from untrusted registry",
    "image 'nginx' comes from untrusted registry"
  ]
}</code>
                            </pre></div></div><div class="text-center blue"><button class="mt-4 btn btn-primary btn-playground"><a target="_blank" href="https://play.openpolicyagent.org/p/9OTwNMYSog">Open In Playground
<img src="https://d33wubrfki0l68.cloudfront.net/636e8b60e8dfcf5619ecb9ceea4bba9a526ca7d9/2d2ec/live-blocks/icons/playground-open.svg" class="launch-playground-icon"></a></button></div></div><div class="tab-pane fade" id="v-pills-k8s-2-mobile-content" role="tabpanel" aria-labelledby="v-pills-k8s-2-mobile-content-tab"><div class="col-12 highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Input">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/a72e369b12655c412801fbd814fe535d9f666efc/bdf60/live-blocks/icons/input.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                              <code class="language-live" data-lang="live:kubernetes_ingress_check_mobile:input:hidden">{
    "apiVersion": "admission.k8s.io/v1beta1",
    "kind": "AdmissionReview",
    "request": {
        "kind": {
            "group": "extensions",
            "kind": "Ingress",
            "version": "v1beta1"
        },
        "object": {
            "metadata": {
                "name": "prod",
                "namespace": "bar"
            },
            "spec": {
                "rules": [
                    {
                        "host": "initech.com",
                        "http": {
                            "paths": [
                                {
                                    "backend": {
                                        "serviceName": "banking",
                                        "servicePort": 443
                                    },
                                    "path": "/finance"
                                }
                            ]
                        }
                    }
                ]
            }
        }
    }
}</code>
                            </pre></div></div><div class="highlight"><a onclick="window.open(&quot;https://play.openpolicyagent.org/p/lttuKeuUpW&quot;)"><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/155a3123feaa31368bec7dd7ea5ccc5140457d50/b4277/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                              <code class="language-live" data-lang="live:kubernetes_ingress_check_mobile:module:read_only">package kubernetes.admission

import future.keywords

# Reject any ingress with the same host as an existing ingress
deny contains msg if {
	input.request.kind.kind == "Ingress"

	# iterate over all hosts in input Ingress
	some rule in input.request.object.spec.rules
	newhost := rule.host

	# iterate over all existing ingresses and all hosts for each ingress
	some namespace, name
	some oldrule in data.kubernetes.ingresses[namespace][name].spec.rules
	oldhost := oldrule.host

	# reject if the oldhost and the newhost are the same
	newhost == oldhost
	msg := sprintf("ingress host conflicts with ingress %s/%s", [namespace, name])
}</code>
                            </pre></div></a></div><div class="highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/c727984413d6c6b592f82ed5646785be10c35074/29a96/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                              <code class="language-live" data-lang="live:kubernetes_ingress_check_mobile:output:hidden">{
  "deny": []
}</code>
                            </pre></div></div><div class="text-center blue"><button class="mt-4 btn btn-primary btn-playground"><a target="_blank" href="https://play.openpolicyagent.org/p/lttuKeuUpW">Open In Playground
<img src="https://d33wubrfki0l68.cloudfront.net/636e8b60e8dfcf5619ecb9ceea4bba9a526ca7d9/2d2ec/live-blocks/icons/playground-open.svg" class="launch-playground-icon"></a></button></div></div></div></div></div></div></div></div><div class="col-12 mt-3 mt-sm-5" id="envoy"><div class="declarative-policy-contentBox"><div class="declarative-policy-contentBox-header"><img src="https://d33wubrfki0l68.cloudfront.net/455409a53c04437f56a44c00d688dc354f65c656/b0182/img/policyicon-2.png" class="declarativeImage"><p class="declarativeText declarativeEnvoy">Envoy</p></div><div class="row"><div class="col-12 col-sm-12 col-md-12 col-lg-4"><div class="declarative-left"><div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical"><a class="nav-link active" id="v-pills-envoy-1-mobile-tab" data-toggle="pill" href="#v-pills-envoy-1-mobile-content" role="tab" aria-controls="v-pills-envoy-1-mobile-content" aria-selected="true">Allow everyone to run GET on
<code>/pets</code></a>
<a class="nav-link" id="v-pills-envoy-2-mobile-tab" data-toggle="pill" href="#v-pills-envoy-2-mobile-content" role="tab" aria-controls="v-pills-envoy-2-mobile-content" aria-selected="false">Allow
frontend service to run GET on <code>/pets/owners</code></a></div></div></div><div class="col-12 col-sm-12 col-md-12 col-lg-8"><div class="declarative-right"><div class="tab-content code-tab-content" id="v-pills-tabContent"><div class="tab-pane fade show active" id="v-pills-envoy-1-mobile-content" role="tabpanel" aria-labelledby="v-pills-envoy-1-mobile-tab"><div class="col-12 highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Input">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/a72e369b12655c412801fbd814fe535d9f666efc/bdf60/live-blocks/icons/input.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                              <code class="language-live" data-lang="live:envoy_get_pets_mobile:input:hidden">{
    "attributes": {
        "destination": {
            "address": {
                "Address": {
                    "SocketAddress": {
                        "PortSpecifier": {
                            "PortValue": 8000
                        },
                        "address": "172.17.0.8"
                    }
                }
            }
        },
        "request": {
            "http": {
                "headers": {
                    ":authority": "example-app",
                    ":method": "GET",
                    ":path": "/pets",
                    "user-agent": "Wget",
                    "x-forwarded-proto": "http",
                    "x-request-id": "4d75f8d5-983f-4ec5-92bb-d27e620b4921"
                },
                "host": "example-app",
                "id": "8910035251488566126",
                "method": "GET",
                "path": "/pets",
                "protocol": "HTTP/1.1"
            }
        },
        "source": {
            "address": {
                "Address": {
                    "SocketAddress": {
                        "PortSpecifier": {
                            "PortValue": 54292
                        },
                        "address": "172.17.0.6"
                    }
                }
            }
        }
    },
    "parsed_path": [
        "pets"
    ]
}</code>
                            </pre></div></div><div class="highlight"><a onclick="window.open(&quot;https://play.openpolicyagent.org/p/WXAYEQWHKI&quot;)"><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/155a3123feaa31368bec7dd7ea5ccc5140457d50/b4277/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                              <code class="language-live" data-lang="live:envoy_get_pets_mobile:module:read_only">package envoy.authz

import future.keywords

# allow all GET requests to /pets
default allow := false

allow if {
	input.attributes.request.http.method == "GET"
	input.attributes.request.http.path == "/pets"
}</code>
                            </pre></div></a></div><div class="highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/c727984413d6c6b592f82ed5646785be10c35074/29a96/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                              <code class="language-live" data-lang="live:envoy_get_pets_mobile:output:hidden">{
  "allow": true
}</code>
                            </pre></div></div><div class="text-center blue"><button class="mt-4 btn btn-primary btn-playground"><a target="_blank" href="https://play.openpolicyagent.org/p/WXAYEQWHKI">Open In Playground
<img src="https://d33wubrfki0l68.cloudfront.net/636e8b60e8dfcf5619ecb9ceea4bba9a526ca7d9/2d2ec/live-blocks/icons/playground-open.svg" class="launch-playground-icon"></a></button></div></div><div class="tab-pane fade" id="v-pills-envoy-2-mobile-content" role="tabpanel" aria-labelledby="v-pills-envoy-2-mobile-tab"><div class="col-12 highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Input">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/a72e369b12655c412801fbd814fe535d9f666efc/bdf60/live-blocks/icons/input.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                              <code class="language-live" data-lang="live:envoy_get_pets_owners_mobile:input:hidden">{
    "attributes": {
        "destination": {
            "address": {
                "Address": {
                    "SocketAddress": {
                        "PortSpecifier": {
                            "PortValue": 8000
                        },
                        "address": "172.17.0.8"
                    }
                }
            }
        },
        "request": {
            "http": {
                "headers": {
                    ":authority": "example-app",
                    ":method": "GET",
                    ":path": "/pets/owners",
                    "user-agent": "Wget",
                    "x-forwarded-client-cert": "By=spiffe://domain.test/db-server;Hash=331f2f4eb2a1729fa4e0f46c8c663786098151ae571fed7b66680e970f6a0f94;URI=spiffe://domain.test/frontend",
                    "x-forwarded-proto": "http",
                    "x-request-id": "4d75f8d5-983f-4ec5-92bb-d27e620b4921"
                },
                "host": "example-app",
                "id": "8910035251488566126",
                "method": "GET",
                "path": "/pets/owners",
                "protocol": "HTTP/1.1"
            }
        },
        "source": {
            "address": {
                "Address": {
                    "SocketAddress": {
                        "PortSpecifier": {
                            "PortValue": 54292
                        },
                        "address": "172.17.0.6"
                    }
                }
            }
        }
    },
    "parsed_path": [
        "pets",
        "owners"
    ]
}</code>
                            </pre></div></div><div class="highlight"><a onclick="window.open(&quot;https://play.openpolicyagent.org/p/6t8n43lY8W&quot;)"><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/155a3123feaa31368bec7dd7ea5ccc5140457d50/b4277/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                              <code class="language-live" data-lang="live:envoy_get_pets_owners_mobile:module:read_only">package envoy.authz

import future.keywords
import input.attributes.request.http as http_request

# allow only the frontend service to GET /pets/owners
default allow := false

allow if {
	http_request.path == "/pets/owners"
	http_request.method == "GET"
	source_spiffe_id == "spiffe://domain.test/frontend"
}

source_spiffe_id = client_id if {
	[_, _, uri_type_san] := split(http_request.headers["x-forwarded-client-cert"], ";")
	[_, client_id] := split(uri_type_san, "=")
}</code>
                            </pre></div></a></div><div class="highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/c727984413d6c6b592f82ed5646785be10c35074/29a96/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                              <code class="language-live" data-lang="live:envoy_get_pets_owners_mobile:output:hidden">{
  "allow": true,
  "source_spiffe_id": "spiffe://domain.test/frontend"
}</code>
                            </pre></div></div><div class="text-center blue"><button class="mt-4 btn btn-primary btn-playground"><a target="_blank" href="https://play.openpolicyagent.org/p/6t8n43lY8W">Open In Playground
<img src="https://d33wubrfki0l68.cloudfront.net/636e8b60e8dfcf5619ecb9ceea4bba9a526ca7d9/2d2ec/live-blocks/icons/playground-open.svg" class="launch-playground-icon"></a></button></div></div></div></div></div></div></div></div><div class="col-12 mt-3 mt-sm-5" id="application"><div class="declarative-policy-contentBox"><div class="declarative-policy-contentBox-header"><img src="https://d33wubrfki0l68.cloudfront.net/c83ed7e2ae33852707ebfa94184e6a408b4b5734/fa9cc/img/policyicon-4.png" class="declarativeImage"><p class="declarativeText">Application</p></div><div class="row"><div class="col-12 col-sm-12 col-md-12 col-lg-4"><div class="declarative-left"><div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical"><a class="nav-link active" id="v-pills-app-1-mobile-tab" data-toggle="pill" href="#v-pills-app-1-mobile-content" role="tab" aria-controls="v-pills-app-1-mobile-content" aria-selected="true">Only the pet's owner can update
that pet's information</a>
<a class="nav-link" id="v-pills-app-2-mobile-tab" data-toggle="pill" href="#v-pills-app-2-mobile-content" role="tab" aria-controls="v-pills-app-2-mobile-content" aria-selected="false">Only
employees, authenticated with a JWT, can see already
adopted pets</a></div></div></div><div class="col-12 col-sm-12 col-md-12 col-lg-8"><div class="declarative-right"><div class="tab-content code-tab-content" id="v-pills-tabContent"><div class="tab-pane fade show active" id="v-pills-app-1-mobile-content" role="tabpanel" aria-labelledby="v-pills-app-1-mobile-tab"><div class="col-12 highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Input">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/a72e369b12655c412801fbd814fe535d9f666efc/bdf60/live-blocks/icons/input.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                              <code class="language-live" data-lang="live:app_check_owner_mobile:input:hidden">{
    "method": "PUT",
    "owner": "bob@hooli.com",
    "path": [
        "pets",
        "pet113-987"
    ],
    "user": "alice@hooli.com"
}</code>
                            </pre></div></div><div class="highlight"><a onclick="window.open(&quot;https://play.openpolicyagent.org/p/0FjgydMuVo&quot;)"><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/155a3123feaa31368bec7dd7ea5ccc5140457d50/b4277/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                              <code class="language-live" data-lang="live:app_check_owner_mobile:module:read_only">package application.authz

import future.keywords

# Only owner can update the pet's information
# Ownership information is provided as part of OPA's input
default allow := false

allow if {
	input.method == "PUT"
	some petid
	input.path = ["pets", petid]
	input.user == input.owner
}</code>
                            </pre></div></a></div><div class="highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/c727984413d6c6b592f82ed5646785be10c35074/29a96/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                              <code class="language-live" data-lang="live:app_check_owner_mobile:output:hidden">{
  "allow": false
}</code>
                            </pre></div></div><div class="text-center blue"><button class="mt-4 btn btn-primary btn-playground"><a target="_blank" href="https://play.openpolicyagent.org/p/0FjgydMuVo">Open In Playground
<img src="https://d33wubrfki0l68.cloudfront.net/636e8b60e8dfcf5619ecb9ceea4bba9a526ca7d9/2d2ec/live-blocks/icons/playground-open.svg" class="launch-playground-icon"></a></button></div></div><div class="tab-pane fade" id="v-pills-app-2-mobile-content" role="tabpanel" aria-labelledby="v-pills-app-2-mobile-tab"><div class="col-12 highlight"><a onclick="window.open(&quot;https://play.openpolicyagent.org/p/P8RBsigBsU&quot;)"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Input">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/a72e369b12655c412801fbd814fe535d9f666efc/bdf60/live-blocks/icons/input.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                              <code class="language-live" data-lang="live:app_jwt_auth_mobile:input:hidden">{
    "pet_list": [
        {
            "breed": "St. Bernard",
            "name": "Cujo",
            "up_for_adoption": false
        },
        {
            "breed": "Collie",
            "name": "Lassie",
            "up_for_adoption": true
        }
    ],
    "token": "eyJ1IjoiSFMyNTYiLCJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoiYWxpY2UiLCJlbXBsb3llZSI6dHJ1ZSwibmFtZSI6IkFsaWNlIFNtaXRoIn0.vMBYEW8VK9XM7yPkKTu1C3Gy1tOq1A0d4-xYMkkRpEc"
}</code>
                            </pre></div></a></div><div class="highlight"><div class="live--block-container">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Module">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/155a3123feaa31368bec7dd7ea5ccc5140457d50/b4277/live-blocks/icons/module.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                              <code class="language-live" data-lang="live:app_jwt_auth_mobile:module:read_only">package application.authz

import future.keywords

# Everyone can see pets up for adoption
allowed_pets contains pet if {
  some pet in input.pet_list
	pet.up_for_adoption
}

# Employees can see all pets.
allowed_pets contains pet if {
	[_, payload, _] := io.jwt.decode(input.token)
	payload.employee
  some pet in input.pet_list
}</code>
                            </pre></div></div><div class="highlight"><div class="live--block-container" style="display: none;">
<div class="live--icon-bar--outer">
  <div class="live--icon-bar--inner">
    <div class="live--icon--container live--icon--container--indicator" title="Output">
      <img class="live--icon--img" src="https://d33wubrfki0l68.cloudfront.net/c727984413d6c6b592f82ed5646785be10c35074/29a96/live-blocks/icons/output.svg">
    </div>
  </div>
</div>
      <pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">                              <code class="language-live" data-lang="live:app_jwt_auth_mobile:output:hidden">{
  "allowed_pets": [
    {
      "breed": "Collie",
      "name": "Lassie",
      "up_for_adoption": true
    },
    {
      "breed": "St. Bernard",
      "name": "Cujo",
      "up_for_adoption": false
    }
  ]
}</code>
                            </pre></div></div><div class="text-center blue"><button class="mt-4 btn btn-primary btn-playground"><a target="_blank" href="https://play.openpolicyagent.org/p/P8RBsigBsU">Open In Playground
<img src="https://d33wubrfki0l68.cloudfront.net/636e8b60e8dfcf5619ecb9ceea4bba9a526ca7d9/2d2ec/live-blocks/icons/playground-open.svg" class="launch-playground-icon"></a></button></div></div></div></div></div></div></div></div></div></div></section><div class="declarative-policy-tabs-graphic-2"></div></section><section id="declarative-policy-tabs"><div class="declarative-policy-tabs-graphic"></div><div class="container"><div class="row"><div class="col-12 col-sm-12 col-md-6"><p><span style="font-weight:600">Declarative.</span> Express policy in
a high-level,
declarative language that promotes safe,
performant, fine-grained controls. Use a language
purpose-built for policy in a world where JSON is
pervasive. Iterate, traverse hierarchies, and apply
150+ built-ins like string manipulation and JWT
decoding to declare the policies you want enforced.</p></div><div class="col-12 col-sm-12 col-md-6 mt-3 mt-sm-0"><p><span style="font-weight:600">Context-aware.</span> Leverage
external information to
write the policies you really care about. Stop
inventing roles that represent complex relationships
that years down the road no one will understand.
Instead, write logic that adapts to the world around
it and attach that logic to the systems that need it.</p></div></div><div class="row center-align-content text-center"><div class="col-12 mt-2"><div class="mt-4" style="font-weight:600"><label>Learn More</label></div><div class="mt-2"><a href="./docs/latest/kubernetes-introduction/" class="btn more-link btn-primary" target="_blank">Kubernetes</a>
<a href="./docs/latest/envoy-introduction/" class="btn btn-primary more-link" target="_blank">Envoy</a>
<a href="./docs/latest/terraform/" class="btn more-link btn-primary" target="_blank">Terraform</a>
<a href="./docs/latest/kafka-authorization/" class="btn more-link btn-primary" target="_blank">Kafka</a>
<a href="https://blog.openpolicyagent.org/write-policy-in-opa-enforce-policy-in-sql-d9d24db93bf4" class="btn more-link btn-primary" target="_blank">SQL</a>
<a href="./docs/latest/ssh-and-sudo-authorization/" class="btn more-link btn-primary" target="_blank">Linux</a></div></div></div></div></section><section id="curveImage"><img src="https://d33wubrfki0l68.cloudfront.net/216fcd2a1339271c29bb53b742b6d5464cf749bc/58965/img/curve.png"></section><section id="architectural-flexibility"><div class="architectural-flexibility-graphic-left"></div><div class="architectural-flexibility-graphic-right"></div><div class="container"><div class="row"><div class="col-12 text-center"><h2>Architectural Flexibility</h2><div class="subText colorGray">Balance integration, availability,
consistency</div></div></div><div class="row"><div class="col-12 col-sm-12 col-md-6"><div class="directBox text-center"><div class="pt-3 pb-3"><h3>Daemon</h3></div><div class="service-circle"><div class="service-text dark"><h3>Service</h3></div></div><div class="service-graphics"><img src="https://d33wubrfki0l68.cloudfront.net/539cdea7bd5dac481d3f354c1e071e5e514f1507/739e9/img/deployment-options-3.png"><div class="service-graphics-text"><div class="row"><div class="col-3"></div><div class="col-3 space-left blackColor">Policy<br>(Rego)</div><div class="col-3 space-right blackColor">Data<br>(JSON)</div><div class="col-3"></div></div><div class="mt-5 text-left"><p>Deploy OPA as a separate process on the same
host as your service. Integrate OPA by changing
your service’s code, importing an OPA-enabled
library, or using a network proxy integrated with OPA.</p></div></div></div></div></div><div class="col-12 col-sm-12 col-md-6"><div class="directBox text-center"><div class="pt-3 pb-3"><h3>Library</h3></div><div class="service-mediumcircle"><div class="service-subtext dark pt-5"><h3>Service</h3><div class="service-smallCircle"><img src="https://d33wubrfki0l68.cloudfront.net/5482b93bd5e267267f80ed4ea8b88966dbc1cff8/ff913/img/logo.png"></div></div></div><div class="service-graphic"><img src="https://d33wubrfki0l68.cloudfront.net/be6915282467f723d0c67cb8666e4c59965dd2b1/cb561/img/deployment-options-1.png"><div class="service-graphics-text"><div class="row"><div class="col-3"></div><div class="col-3 space-left blackColor">Policy<br>(Rego)</div><div class="col-3 space-right blackColor">Data<br>(JSON)</div><div class="col-3"></div></div><div class="mt-5 text-left"><p>Embed OPA policies into your service. Integrate OPA as a Go
library
that evaluates policy, or integrate a WebAssembly runtime
and use OPA
to compile policy to WebAssembly instructions.</p></div></div></div></div></div></div><div class="row text-center center-align-content"><div class="col-12 mt-2"><div class="mt-4" style="font-weight:600"><label>Learn More</label></div><div class="mt-2"><a href="./docs/latest/deployments/" class="btn btn-primary more-link" target="_blank">Daemon</a>
<a href="./docs/latest/integration/#integrating-with-the-go-api" class="btn btn-primary more-link" target="_blank">Library</a></div></div></div></div></section><section id="curveImage"><img src="https://d33wubrfki0l68.cloudfront.net/245ec2160f362ef4fab916e4567567a34448318d/fde5f/img/curve-up.png"></section><section id="policy-authoring"><div class="container"><div class="row"><div class="col-12 text-center"><h2>Tools for Policy Authoring</h2><div class="subText">IDEs, Sharing, Profiling, Testing, Coverage</div></div></div><div class="row text-center center-align-content"><div class="col-12 col-sm-12 col-md-12 col-lg-6 p-sm-0"><div class="policy-sharing center-align-content"><img src="https://d33wubrfki0l68.cloudfront.net/631b3cb3867f1dd59c080d4ca02fd66983a1220a/28e1d/img/tools-playground.png" class="img-fluid"><h4>Rego Playground for Policy Sharing</h4></div></div><div class="col-12 col-sm-12 col-md-12 col-lg-6 p-sm-0"><div class="policy-sharing center-align-content"><img src="https://d33wubrfki0l68.cloudfront.net/af9b9977fdfadb1c2261c8ff7b8ad32eaf90d991/37ed6/img/tools-vscode.png" class="img-fluid"><h4>VS Code for Policy Authoring</h4></div></div><div class="col-12 col-sm-12 col-md-12 col-lg-6 p-sm-0"><div class="policy-sharing center-align-content"><img src="https://d33wubrfki0l68.cloudfront.net/8ede666e8c6c0199aac1eb6ac49e29b99da19dba/931e8/img/tools-cli.png" class="img-fluid"><h4>CLI and REPL for complete control</h4></div></div><div class="col-12 mt-3 policy-text text-left"><p>OPA embraces policy-as-code, complete with tools that help people
use and understand the policies they put
in
place. Integrated development environments, testing, profiling,
coverage, automated performance tuning, and
hot
reloading aren’t just things you need for programming--you need them
for policy too, and OPA delivers.</p></div></div><div class="row text-center center-align-content"><div class="col-12 mt-2"><div class="mt-4" style="font-weight:600"><label>Learn More</label></div><div class="mt-2"><a href="https://marketplace.visualstudio.com/items?itemName=tsandall.opa" class="btn btn-primary more-link" target="_blank">VS Code</a>
<a href="https://play.openpolicyagent.org/" class="btn btn-primary more-link" target="_blank">Rego Playground</a>
<a href="./docs/latest/#running-opa" class="btn btn-primary more-link" target="_blank">General Tooling</a>
<a href="https://github.com/open-policy-agent" class="btn btn-primary more-link" target="_blank">OPA GitHub</a></div></div></div></div></section><section id="footer" class="mt-sm-5"><div class="container"><div class="row"><div class="col-12"><div class="footer-text">Open Policy Agent is a Cloud Native Computing Foundation graduated
project.</div><div class="footer-logo pb-4"><img src="https://d33wubrfki0l68.cloudfront.net/66f2dd9b4aa7694c36b51dec31f2190feec3c619/dd804/img/cloud-native-logo.png"></div><div class="footer-bottom">© 2023 Open Policy Agent contributors. Licensed under the Apache
License, Version 2.0. For information about
contributing, <a href="/docs/latest/contributing/">see documentation</a>.</div></div></div></div></section><script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/smooth-scroll/16.0.3/smooth-scroll.min.js" integrity="sha512-hM2bR27jBQ+BEMPGN5s+d1vgOk9igjvb4cH0LWXA6zqFYEPYJoLGA/3s9YoRCOaQQ+8FyunCOpoptJqhwIY83g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>$(function(){var e=50,t=new SmoothScroll('a[href*="#"]',{speed:500,offset:e})})</script><script>$('a[data-toggle="pill"],a[data-toggle="tab"]').on("shown.bs.tab",function(){$(".CodeMirror").each(function(){this.CodeMirror.refresh()})})</script><script src="/js/live-blocks.js"></script></body></html>